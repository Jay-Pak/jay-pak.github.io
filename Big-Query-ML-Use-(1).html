<p>이번 포스트에서는 Binary logistics Regressor를 이용한 Classification Model을 BigQuery ML을 이용하여 만들어 보고자 한다.</p>

<p>앞서 이야기한대로 <code class="highlighter-rouge">BigQuery ML</code>은 Linear Regression(선형 회귀), Binary logistic regression(이진 로지스틱 회귀)의 모델을 생성 할 수 있다. <code class="highlighter-rouge">Linear Regressor</code>는 수치를 예측 하고자 할 때, <code class="highlighter-rouge">Binary logistics regression</code>은 분류 예측을 하고자 할때 사용한다.</p>

<p>이번 Post는 Google Merchandise Store의 구매 자료를 토대로 방문자의 구매 확률에 대해 예측 하는 모델을 생성 하고, 실제 생성된 모델을 기반으로 실제 구매 여부 및 모델 평가(Model Evaluation)까지 해볼 것이다.</p>

<h1 id="1데이터-탐색-및-데이터-이해하기">1.데이터 탐색 및 데이터 이해하기</h1>

<p>우선 Machine Learning을 위해서는 데이터에 대한 이해 및 탐색. 그리고, 예측을 위해 필요한 데이터의 특성은 무엇인가에 대한 이해가 선행 되어야 한다. 우선 데이터의 이해를 위해 전체 방문자 대비 구매자의 비율을 구하는 쿼리를 수행 해보도록 한다.</p>

<blockquote>

  <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span><span class="n">standardSQL</span>
<span class="k">WITH</span> <span class="n">visitors</span> <span class="k">AS</span><span class="p">(</span>
<span class="k">SELECT</span>
<span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">fullVisitorId</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_visitors</span>
<span class="k">FROM</span> <span class="nv">`data-to-insights.ecommerce.web_analytics`</span>
<span class="p">),</span>
<span class="n">purchasers</span> <span class="k">AS</span><span class="p">(</span>
<span class="k">SELECT</span>
<span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">fullVisitorId</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total_purchasers</span>
<span class="k">FROM</span> <span class="nv">`data-to-insights.ecommerce.web_analytics`</span>
<span class="k">WHERE</span> <span class="n">totals</span><span class="p">.</span><span class="n">transactions</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
<span class="k">SELECT</span>
  <span class="n">total_visitors</span><span class="p">,</span>
  <span class="n">total_purchasers</span><span class="p">,</span>
  <span class="n">total_purchasers</span> <span class="o">/</span> <span class="n">total_visitors</span> <span class="k">AS</span> <span class="n">conversion_rate</span>
<span class="k">FROM</span> <span class="n">visitors</span><span class="p">,</span> <span class="n">purchasers</span>
</code></pre></div>  </div>

</blockquote>

<p><code class="highlighter-rouge">data-to-insights.ecommerce.web_analytics</code> 는 BigQuery ML을 Test 하기 위해 Merchandise Store의 데이터를 공개한 것이며, 위의 데이터는 전체 방문자 대비 실제 구매자를 구하는 데이터이다. 위의 with절의 visitor는 방문자의 ID를 Count 하는 데이터이고, purchasers는 전체 데이터중 Transaction Flag가 있는 경우를 거래가 이루어진 것으로 보고, Count 한 데이터이다.</p>

<center>
    <img src="../assets/images/bigquery/Bigquery-ML-1.png" />
	<br />
    <em>&lt; Fig. 1 - 방문자 대비 실제 구매자 &gt;</em>
</center>

